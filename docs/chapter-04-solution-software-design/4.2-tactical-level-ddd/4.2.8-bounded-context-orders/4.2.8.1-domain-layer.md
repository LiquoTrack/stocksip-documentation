### 4.2.8. Bounded Context: Procurement Ordering ###

#### 4.2.8.1. Domain Layer ####

La **Domain Layer** representa el **núcleo del Bounded Context** de Procurement Ordering y encapsula toda la **lógica de negocio** relacionada con órdenes de compra (`PurchaseOrder`) y carritos (`Cart`).  
Esta capa es **agnóstica de infraestructura y tecnología**, y su objetivo principal es mantener la **consistencia del dominio**, modelando conceptos y comportamientos del negocio.

## Aggregates

| Nombre            | Descripción                                                                                                                                 | Atributos                                                                                                                                                                                | Métodos                                                           |
|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|
| **PurchaseOrder** | Representa la orden de compra generada por un comprador a partir de un catálogo. Es el Aggregate Root que gestiona los `PurchaseOrderItem`. | `OrderCode: string, Items: ICollection<PurchaseOrderItem>, Status: EPurchaseOrderStatuses, CatalogToBuyFromId: CatalogId, GenerationDate: DateTime, Buyer: AccountID, TotalToPay: Money` | `SendOrder(): void`                                               |
| **Cart**          | Representa un carrito temporal donde un comprador agrega ítems antes de generar una orden de compra.                                        | `Id: string, Items: ICollection<CartItem>, Buyer: AccountId, GenerationDate: DateTime, ModificationDate: DateTime`                                                                       | `AddItem(), RemoveItem(), Update(), CalculateTotal(), CheckOut()` |

---

## Entities

| Nombre                | Descripción                                                                                              | Atributos                                                                                          | Métodos                   |
|-----------------------|----------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|---------------------------|
| **PurchaseOrderItem** | Representa un ítem dentro de la orden de compra, con referencia al producto, cantidad y precio unitario. | `{ ProductOrder: ProductId, UnitPrice: Money, InventoryId: InventoryId, QuantityToPurchase: int }` | `{ CalculateSubTotal() }` |
| **CartItem**          | Representa un ítem dentro del carrito, con referencia al producto del catálogo, cantidad y precio.       | `{ Id: string, CatalogItemId: CatalogItemId, UnitPrice: Money, QuantityToPurchase: int }`          | `{ CalculateSubtotal() }` |

---

## Value Objects

| Nombre                     | Descripción                                                                                 | Atributos / Métodos                                                                                       |
|----------------------------|---------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
| **CatalogItemId**          | Identificador de un producto dentro de un catálogo. Garantiza unicidad y consistencia.      | `Atributos: { Id: string }`                                                                               |
| **EPurchaseOrderStatuses** | Enumeración que define los estados posibles de una orden de compra.                         | `Valores: Sent, Processing, Confirmed, Delivering, Received, Canceled`                                    |
| **IConfirmable**           | Interfaz que asegura que una orden o entidad confirmable siga un ciclo de vida predefinido. | `Métodos: SendOrder(), ProcessConfirmed(), ConfirmOrder(), DeliverOrder(), ReceiveOrder(), CancelOrder()` |

---

## Services

| Nombre                           | Descripción                                                                  | Métodos (Commands / Queries)                                                                                                                        |
|----------------------------------|------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| **IPurchaseOrderCommandService** | Interfaz que define operaciones de negocio para gestionar órdenes de compra. | `CreatePurchaseOrder(CreatePurchaseOrderCommand), UpdatePurchaseOrder(UpdatePurchaseOrderCommand), CancelPurchaseOrder(CancelPurchaseOrderCommand)` |
| **ICartCommandService**          | Interfaz que gestiona el ciclo de vida del carrito de compras.               | `AddItem(AddItemToCartCommand), RemoveItem(RemoveItemFromCartCommand), UpdateItem(UpdateCartItemCommand), CheckoutCart(CheckoutCartCommand)`        |
| **IPurchaseOrderQueryService**   | Interfaz que expone consultas sobre las órdenes de compra.                   | `GetById(Guid id), GetByBuyer(AccountId buyer), GetAll(), GetByStatus(EPurchaseOrderStatuses status)`                                               |
| **ICartQueryService**            | Interfaz que expone consultas sobre carritos.                                | `GetCartById(Guid id), GetCartByBuyer(AccountId buyer)`                                                                                             |

---

## Repositories

| Nombre                       | Descripción                                         | Métodos                                                                                                                                                                                                               |
|------------------------------|-----------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **IPurchaseOrderRepository** | Define la persistencia para las órdenes de compra.  | `Task<PurchaseOrder?> GetByIdAsync(Guid id), Task<IEnumerable<PurchaseOrder>> GetByBuyerAsync(AccountId buyer), Task AddAsync(PurchaseOrder order), Task UpdateAsync(PurchaseOrder order), Task DeleteAsync(Guid id)` |