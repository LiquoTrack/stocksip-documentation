#### 4.2.3.4. Infrastructure Layer ####

La **Infrastructure Layer** se encarga de la **persistencia de datos**, integración con servicios externos y soporte técnico para la **Application Layer** y el **Domain Layer**.  
Aquí se implementan los **Repositories**, adaptadores y cualquier componente que dependa de la tecnología específica utilizada.

---

## Repositories

| Nombre                        | Descripción                                                                               | Implementación                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-------------------------------|-------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **WarehouseRepository**       | Persistencia de los almacenes en la base de datos (implementa `IWarehouseRepository`).    | - `AddAsync(Warehouse warehouse)` → Insertar nuevo almacén.<br>- `UpdateAsync(Warehouse warehouse)` → Actualizar almacén existente.<br>- `DeleteAsync(Guid id)` → Eliminar almacén.<br>- `GetByIdAsync(Guid id)` → Obtener almacén por Id.<br>- `GetAllAsync()` → Obtener todos los almacenes.                                                                                                                                      |
| **ProductRepository**         | Persistencia de los productos en la base de datos (implementa `IProductRepository`).      | - `AddAsync(Product product)` → Insertar nuevo producto.<br>- `UpdateAsync(Product product)` → Actualizar producto existente.<br>- `DeleteAsync(Guid id)` → Eliminar producto.<br>- `GetByIdAsync(Guid id)` → Obtener producto por Id.<br>- `GetAllAsync()` → Obtener todos los productos.                                                                                                                                          |
| **InventoryRepository**       | Persistencia de los inventarios (implementa `IInventoryRepository`).                      | - `AddAsync(Inventory inventory)` → Insertar nuevo inventario.<br>- `UpdateAsync(Inventory inventory)` → Actualizar inventario existente.<br>- `GetByIdAsync(Guid id)` → Obtener inventario por Id.<br>- `GetByProductIdAsync(Guid productId)` → Obtener inventarios de un producto.<br>- `GetByWarehouseIdAsync(Guid warehouseId)` → Obtener inventarios de un almacén.<br>- `GetAllAsync()` → Obtener todos los inventarios.      |
| **CareGuideRepository**       | Persistencia de guías de cuidado (implementa `ICareGuideRepository`).                     | - `AddAsync(CareGuide guide)` → Insertar nueva guía.<br>- `UpdateAsync(CareGuide guide)` → Actualizar guía existente.<br>- `DeleteAsync(Guid id)` → Eliminar guía.<br>- `GetByIdAsync(Guid id)` → Obtener guía por Id.<br>- `GetByProductIdAsync(Guid productId)` → Obtener guías asociadas a un producto.<br>- `GetAllAsync()` → Obtener todas las guías.                                                                          |
| **CatalogRepository**         | Persistencia de catálogos (implementa `ICatalogRepository`).                              | - `AddAsync(Catalog catalog)` → Insertar nuevo catálogo.<br>- `UpdateAsync(Catalog catalog)` → Actualizar catálogo existente.<br>- `DeleteAsync(Guid id)` → Eliminar catálogo.<br>- `GetByIdAsync(Guid id)` → Obtener catálogo por Id.<br>- `GetByOwnerIdAsync(Guid ownerId)` → Obtener catálogos de un propietario.<br>- `GetAllAsync()` → Obtener todos los catálogos.<br>- `GetPublishedAsync()` → Obtener catálogos publicados. |
| **CatalogItemRepository**     | Persistencia de ítems de catálogos (implementa `ICatalogItemRepository`).                 | - `AddAsync(CatalogItem item)` → Insertar nuevo ítem de catálogo.<br>- `UpdateAsync(CatalogItem item)` → Actualizar ítem existente.<br>- `DeleteAsync(Guid id)` → Eliminar ítem.<br>- `GetByIdAsync(Guid id)` → Obtener ítem por Id.<br>- `GetByCatalogIdAsync(Guid catalogId)` → Obtener ítems de un catálogo.<br>- `GetAllAsync()` → Obtener todos los ítems de catálogos.                                                        |
| **ProductExitRepository**     | Persistencia de registros de salidas de inventario (implementa `IProductExitRepository`). | - `AddAsync(ProductExit exit)` → Registrar nueva salida.<br>- `GetByIdAsync(Guid id)` → Obtener salida por Id.<br>- `GetByInventoryIdAsync(Guid inventoryId)` → Obtener salidas de un inventario.<br>- `GetByDateRangeAsync(DateTime from, DateTime to)` → Obtener salidas en un rango de fechas.<br>- `GetAllAsync()` → Obtener todas las salidas registradas.                                                                     |
| **ProductTransferRepository** | Persistencia de transferencias de productos (implementa `IProductTransferRepository`).    | - `AddAsync(ProductTransfer transfer)` → Registrar nueva transferencia.<br>- `GetByIdAsync(Guid id)` → Obtener transferencia por Id.<br>- `GetByWarehouseIdAsync(Guid warehouseId)` → Obtener transferencias de un almacén.<br>- `GetByDateRangeAsync(DateTime from, DateTime to)` → Obtener transferencias en un rango de fechas.<br>- `GetAllAsync()` → Obtener todas las transferencias registradas.                             |

---

## External File Storage Intregation

| Nombre                           | Descripción                                                                                                                                                 | Implementación                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **CloudinaryFileStorageAdapter** | Adaptador responsable de subir, obtener, transformar y eliminar imágenes de productos y almacenes usando Cloudinary como proveedor de almacenamiento y CDN. | - `Task<string> UploadAsync(Stream fileStream, string fileName, UploadOptions options)` → Sube la imagen y devuelve la URL pública o el identificador en Cloudinary.<br> `Task<string> UploadFromUrlAsync(string remoteUrl, UploadOptions options)` → Importa una imagen desde una URL externa.<br> `Task<bool> DeleteAsync(string publicId)` → Elimina un recurso en Cloudinary.<br> `string GetUrl(string publicId, TransformationOptions options)` → Genera URL con transformaciones (crop, resize, quality, format, responsive). |