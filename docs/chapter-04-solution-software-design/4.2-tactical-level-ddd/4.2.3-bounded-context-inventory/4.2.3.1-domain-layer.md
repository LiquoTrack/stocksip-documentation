### 4.2.3. Bounded Context: Inventory Management ###

#### 4.2.3.1. Domain Layer ####

La capa Inventory Management constituye el núcleo del bounded context dedicado a la gestión de almacenes, productos e inventarios, centralizando toda la lógica de negocio relacionada con el control de stock, catálogos, marcas y guías de conservación.

En esta capa se definen las reglas y comportamientos propios del dominio de inventario: creación y actualización de productos, administración de la capacidad de almacenes, control de niveles mínimos de stock, y manejo de movimientos de inventario para mantener la consistencia operativa.

## Aggregates

| Nombre        | Descripción                                                                                    | Atributos                                                                                                                                                                                             | Métodos                                                                                                                                     |
|---------------|------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| **Warehouse** | Representa un almacén físico donde se gestionan inventarios y productos.                       | `WarehouseId: string, Name: string, Address: WarehouseAddress, Temperature: Temperature, TotalCapacity: Capacity, ImageUrl: ImageUrl, AccountId: AccountId`                                           | `UpdateWarehouses(), ValidateWarehouseName(), ExistsInventoryRelation(), AddInventoryRelation, RemoveInventoryRelation`                     |
| **Product**   | Representa un producto con su información básica, precio, stock mínimo y relación con almacén. | `ProductId: string, ProductName: string, UnitPrice: Money, Brand: Brand, Type: EProductType, MinimumStock: ProductMiniumStock, IsInWarehouse: bool, ImageUrl: ImageUrl, AccountId: AccountId`         | `SetMinimumStock(), GetMinimumStock(), UpdateProductInfo(), AssStockToTotal(), RemoveInventoryRelation()`                                   |
| **Inventory** | Representa el inventario que relaciona productos con almacenes, controlando su stock y estado. | `InventoryId: string, ProductStored: Product, WarehouseStored: Warehouse, ProductId: string, WarehouseId: string, CurrentStock: ProductStock, CurrentState: EProductState`                            | `SetProductStateToOutStock(), SetProductStateToWithStock(), AddStockToProduct(), RemoveStockFromProduct(), MoveProductToAnotherWarehouse()` |
| **CareGuide** | Define guías de cuidado y almacenamiento para productos, según condiciones recomendadas.       | `CareGuideId: string, AccountId: AccountId, ProductId: string, Title: string, Summary: string, RecommendedMaxTemperature: double, RecommendedMinTemperature: double, RecommendedPlaceStorage: string` | `UpdateRecommendations(), UnassignCareGuide(), AsignCareGuideToAnotherProduct()`                                                            |
| **Catalog**   | Representa un catálogo de productos publicados por una cuenta o negocio.                       | `Id: string, Name: string, Descriptions: string, CatlogItems: ICollection<CatalogItem>, OwnerAccount: AccountId, IsPublished: bool`                                                                   | `PublishCatalog(), UnpublishCatalog(), UpdateCatalog(), AddItem(), RemoveItem(), GetOwnerAccount()`                                         |

---

## Entities

| Nombre              | Descripción                                                                | Atributos                                                                                                              | Métodos                                                          |
|---------------------|----------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|
| **Brand**           | Representa la marca asociada a un producto.                                | `Id: string, Name: EBrandName`                                                                                         |                                                                  |
| **ProductTransfer** | Representa un movimiento de producto entre almacenes.                      | `Id: string, OriginalInventoryId: string, NewWarehouseId: string, ProductToTransferId: string, TransferDate: DateTime` | `UpdateInventoryAfterTransfer()`                                 |
| **ProductExit**     | Registra la salida de un producto del inventario por una razón específica. | `Id: string, InventoryAffectedId: Inventory, ExitReason: EProductExitReason, OutputQuantity: int, ExitDate: DateTime ` | `UpdateInventoryAfterExit()`                                     |
| **CatalogItem**     | Representa un producto dentro de un catálogo con su stock y precio.        | `ProductId: ProductId, InventoryId: InventoryId, UnitPrice: Money, StockAvailable: int, AddedDate: DateTime`           | `UpdateUnitPrice(), UpdateStockAvailable(), RemoveFromCatalog()` |

---

## Value Objects

| Nombre                   | Descripción                                                 | Atributos / Métodos                                                                                                              |
|--------------------------|-------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------|
| **Capacity**             | Define la capacidad máxima de un almacén.                   | `Atributos: { TotalCapacity: double }`                                                                                           |
| **EProductState**        | Define los posibles estados de un producto en inventario.   | `Valores: InStock, OutOfStock, Reserved, Damaged`                                                                                |
| **ProductStock**         | Controla el stock de un producto en inventario.             | `Atributos: { Stock: int }` `Métodos: IsStockValid(), IncreaseStock(), ReduceStock(), GetCurrentStock()`                         |
| **Temperature**          | Representa la temperatura de almacenamiento.                | `Atributos: { Temperature: double }` `Métodos: IsTemperatureValid()`                                                             |
| **WarehouseAddress**     | Define la dirección completa de un almacén.                 | `Atributos: { Street: string, City: string, District: string, PostalCode: string, Country: string }` `Métodos: IsAddressValid()` |
| **EProductType**         | Enum con los diferentes tipos de productos gestionados.     | `Valores: Snack, Soda, Wine, Whisky, Rum, Tequila`                                                                               |
| **EProductMinimumStock** | Valor objeto para el stock mínimo permitido de un producto. | `Atributos: { MinimumStock: int }` `Métodos: IsMinimumStockValid(), GetMinimumStock(), UpdateMinimumStock()`                     |
| **ProductContent**       | Representa el contenido (peso/volumen) de un producto.      | `Atributos: { Content: double }` `Métodos: IsContentValid`                                                                       |
| **EBrandName**           | Enum con las marcas disponibles.                            | `Valores: Tabernero, Queirolo, Cartavio`                                                                                         |
| **EProductExitReasons**  | Enum con razones de salida de productos.                    | `Valores: Expired, Damaged, Sold, Lost, Other`                                                                                   |

---

## Services

| Nombre                       | Descripción                                                                 | Métodos (Commands / Queries)                                                                                                             |
|------------------------------|-----------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------|
| **IWarehouseCommandService** | Gestiona operaciones de creación, actualización y eliminación de almacenes. | `CreateWarehouseCommand, UpdateWarehouseCommand, DeleteWarehouseCommand`                                                                 |
| **IProductCommandService**   | Gestiona operaciones sobre productos (alta, baja, actualización).           | `CreateProductCommand, UpdateProductCommand, DeleteProductCommand, AssignProductToWarehouseCommand`                                      |
| **IInventoryCommandService** | Gestiona operaciones sobre inventarios (stock, movimientos, ajustes).       | `CreateInventoryCommand, AddStockCommand, RemoveStockCommand, TransferProductCommand, UpdateInventoryStateCommand`                       |
| **IBrandCommandService**     | Gestiona la creación y modificación de marcas.                              | `CreateBrandCommand, UpdateBrandCommand, DeleteBrandCommand`                                                                             |
| **ICareGuideCommandService** | Gestiona las guías de cuidado de productos.                                 | `CreateCareGuideCommand, UpdateCareGuideCommand, DeleteCareGuideCommand, AssignCareGuideToProductCommand`                                |
| **ICatalogCommandService**   | Gestiona la creación y publicación de catálogos.                            | `CreateCatalogCommand, UpdateCatalogCommand, PublishCatalogCommand, UnpublishCatalogCommand, AddItemToCatalogCommand, RemoveItemCommand` |
| **IWarehouseQueryService**   | Consulta información de almacenes.                                          | `GetWarehouseByIdQuery, GetAllWarehousesQuery, GetWarehousesByAccountQuery`                                                              |
| **IProductQueryService**     | Consulta información de productos.                                          | `GetProductByIdQuery, GetAllProductsQuery, GetProductsByWarehouseQuery, GetProductsByBrandQuery`                                         |
| **IInventoryQueryService**   | Consulta información de inventarios y stock.                                | `GetInventoryByIdQuery, GetAllInventoriesQuery, GetInventoriesByWarehouseQuery, GetInventoriesByProductQuery`                            |
| **IBrandQueryService**       | Consulta marcas disponibles.                                                | `GetBrandByIdQuery, GetAllBrandsQuery`                                                                                                   |
| **ICareGuideQueryService**   | Consulta guías de cuidado de productos.                                     | `GetCareGuideByIdQuery, GetAllCareGuidesQuery, GetCareGuidesByProductQuery`                                                              |
| **ICatalogQueryService**     | Consulta catálogos y sus productos.                                         | `GetCatalogByIdQuery, GetAllCatalogsQuery, GetCatalogsByAccountQuery, GetPublishedCatalogsQuery`                                         |

---

## Repositories

| Nombre                         | Descripción                                                        | Métodos                                                                                                                                                                                  |
|--------------------------------|--------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **IInventoryRepository**       | Administra la persistencia de inventarios y control de stock.      | `AddAsync(Inventory inventory), UpdateAsync(Inventory inventory), DeleteAsync(Guid id), GetByIdAsync(Guid id), GetByWarehouseAsync(Guid warehouseId), GetByProductAsync(Guid productId)` |
| **IProductRepository**         | Administra la persistencia de productos.                           | `AddAsync(Product product), UpdateAsync(Product product), DeleteAsync(Guid id), GetByIdAsync(Guid id), GetByWarehouseAsync(Guid warehouseId), GetByBrandAsync(Guid brandId)`             |
| **ICareGuideRepository**       | Administra la persistencia de guías de cuidado.                    | `AddAsync(CareGuide guide), UpdateAsync(CareGuide guide), DeleteAsync(Guid id), GetByIdAsync(Guid id), GetByProductAsync(Guid productId)`                                                |
| **ICatalogRepository**         | Administra la persistencia de catálogos y sus ítems.               | `AddAsync(Catalog catalog), UpdateAsync(Catalog catalog), DeleteAsync(Guid id), GetByIdAsync(Guid id), GetAllAsync(), GetByAccountAsync(Guid accountId), GetPublishedAsync()`            |
| **IBrandRepository**           | Administra la persistencia de marcas.                              | `AddAsync(Brand brand), UpdateAsync(Brand brand), DeleteAsync(Guid id), GetByIdAsync(Guid id), GetAllAsync()`                                                                            |
| **IProductExitRepository**     | Administra la persistencia de salidas de productos del inventario. | `AddAsync(ProductExit exit), GetByIdAsync(Guid id), GetByInventoryAsync(Guid inventoryId), GetByDateRangeAsync(DateTime start, DateTime end)`                                            |
| **IWarehouseRepository**       | Administra la persistencia de almacenes.                           | `AddAsync(Warehouse warehouse), UpdateAsync(Warehouse warehouse), DeleteAsync(Guid id), GetByIdAsync(Guid id), GetAllAsync(), GetByAccountAsync(Guid accountId)`                         |
| **IProductMovementRepository** | Administra los registros de transferencias de productos.           | `AddAsync(ProductTransfer transfer), GetByIdAsync(Guid id), GetByProductAsync(Guid productId), GetByWarehouseAsync(Guid warehouseId), GetByDateRangeAsync(DateTime start, DateTime end)` |
