### 4.2.5. Bounded Context: Payment And Subscriptions ###

La capa Payment And Subscriptions constituye el núcleo del bounded context encargado de la administración de cuentas y suscripciones de usuarios y negocios, centralizando la lógica relacionada con la gestión de planes de pago y su ciclo de vida.

En esta capa se definen las reglas y comportamientos propios del dominio de pagos y suscripciones: creación y mantenimiento de cuentas (Account), afiliación de usuarios o negocios a planes de pago mediante suscripciones (Subscription), gestión de estados de vigencia y control de renovaciones o cancelaciones.

#### 4.2.5.1. Domain Layer ####

## Aggregates

| Nombre           | Descripción                                                                          | Atributos                                                                                                                                          | Métodos                                                                                            |
|------------------|--------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
| **Account**      | Representa la cuenta de un usuario o negocio dentro del sistema.                     | `Id: string, Business: Business, AccountRole: EAccountRole, Status: EAccountStatus, OwnerUserId: string`                                           | `ActivateAccount(), GetCreationDate(), GetBusinessName(), GetBusinessEmail()`                      |
| **Subscription** | Representa la suscripción de una cuenta a un plan, controlando su estado y vigencia. | `Id: string, SubscribedAccountId: string, SubscribedAccount: Account, AssociatedPlanId: string, AssociatedPlan: Plan, Status: ESubscriptionStatus` | `ActivateSubscription(), ActivateWithPlan(Plan newPlan), CalculateExpirationDate(), UpgradePlan()` |

---

## Entities

| Nombre       | Descripción                                                         | Atributos                                                                                                                                           | Métodos                                                                                   |
|--------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------|
| **Plan**     | Define los planes de suscripción disponibles y sus características. | `Id: string, PlanType: EPlanType, Description: string, PaymentFrequency: EPaymentFrequency, PlanPrice: Money, MaxWarehouses: int, MaxProducts: int` | `CreateFreePlan(), CreatePremiumMonthlyPlan(), CreatePremiumAnnualPlan(), ValidatePlan()` |
| **Business** | Representa un negocio asociado a una cuenta.                        | `Id: string, BusinessName: BusinessName, BusinessEmail: BusinessEmail, Ruc: string`                                                                 | ``                                                                                        |

---

## Value Objects

| Nombre                  | Descripción                                                     | Atributos / Métodos                           |
|-------------------------|-----------------------------------------------------------------|-----------------------------------------------|
| **PlanLimits**          | Define los límites y restricciones de un plan de suscripción.   | `Atributos: { MaxWarehouses, MaxProducts }`   |
| **EPaymentFrequency**   | Define la frecuencia de pago de un plan.                        | `Valores: Monthly, Annual`                    |
| **EPlanType**           | Define el tipo de plan de suscripción.                          | `Valores: Free, Premium`                      |
| **BusinessName**        | Valor que representa el nombre del negocio.                     | `Atributos: { Name: string }`                 |
| **BusinessEmail**       | Valor que representa el correo electrónico del negocio.         | `Atributos: { Email: string }`                |
| **Ruc**                 | Valor que representa el número de RUC del negocio.              | `Atributos: { Ruc: string }`                  |
| **EAccountRole**        | Define los roles que puede tener una cuenta dentro del sistema. | `Valores: Admin o Manager`                    |
| **ESubscriptionStatus** | Define los posibles estados de una suscripción.                 | `Valores: Active, Expired, Canceled, Pending` |
| **EAccountStatus**      | Define los posibles estados de una cuenta.                      | `Valores: Active, Inactive, Suspended`        |
| **AccountRole**         | Valor que representa el rol de la cuenta.                       | `Métodos: { Role: string }`                   |

---

## Services

| Nombre                          | Descripción                                                        | Métodos (Commands / Queries)                                                                                    |
|---------------------------------|--------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
| **ISubscriptionCommandService** | Gestiona la creación, activación y actualización de suscripciones. | `CreateSubscriptionCommand, ActivateSubscriptionCommand, UpgradeSubscriptionCommand, CancelSubscriptionCommand` |
| **IAccountCommandService**      | Gestiona operaciones sobre cuentas de usuario o negocio.           | `CreateAccountCommand, ActivateAccountCommand, SuspendAccountCommand`                                           |
| **IPlanCommandService**         | Gestiona la creación y actualización de planes de suscripción.     | `CreatePlanCommand, UpdatePlanCommand, DeletePlanCommand`                                                       |
| **IBusinessCommandService**     | Gestiona la información de negocios asociados a cuentas.           | `CreateBusinessCommand, UpdateBusinessCommand, DeleteBusinessCommand`                                           |
| **ISubscriptionQueryService**   | Permite consultar suscripciones y sus estados.                     | `GetSubscriptionByIdQuery, GetSubscriptionsByAccountQuery, GetActiveSubscriptionsQuery`                         |
| **IAccountQueryService**        | Permite consultar cuentas de usuario y sus roles/estados.          | `GetAccountByIdQuery, GetAccountsByStatusQuery, GetAccountsByRoleQuery`                                         |
| **IPlanQueryService**           | Permite consultar planes disponibles y sus límites.                | `GetPlanByIdQuery, GetAllPlansQuery, GetPlansByTypeQuery`                                                       |
| **IBusinessQueryService**       | Permite consultar negocios y su información asociada.              | `GetBusinessByIdQuery, GetAllBusinessesQuery`                                                                   |

---

## Repositories

| Nombre                     | Descripción                                              | Métodos                                                                                                                                                                              |
|----------------------------|----------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **AccountRepository**      | Persistencia y consulta de cuentas en la base de datos.  | `AddAsync(Account account), UpdateAsync(Account account), DeleteAsync(Guid id), GetByIdAsync(Guid id), GetByStatusAsync(EAccountStatus status), GetByRoleAsync(EAccountRole role)`   |
| **PlanRepository**         | Persistencia y consulta de planes de suscripción.        | `AddAsync(Plan plan), UpdateAsync(Plan plan), DeleteAsync(Guid id), GetByIdAsync(Guid id), GetAllAsync(), GetByTypeAsync(EPlanType type)`                                            |
| **SubscriptionRepository** | Persistencia y consulta de suscripciones.                | `AddAsync(Subscription subscription), UpdateAsync(Subscription subscription), DeleteAsync(Guid id), GetByIdAsync(Guid id), GetByAccountAsync(AccountId accountId), GetActiveAsync()` |
| **BusinessRepository**     | Persistencia y consulta de negocios asociados a cuentas. | `AddAsync(Business business), UpdateAsync(Business business), DeleteAsync(Guid id), GetByIdAsync(Guid id), GetAllAsync()`                                                            |
