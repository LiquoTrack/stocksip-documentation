#### 4.2.5.4. Infrastructure Layer ####

La **Infrastructure Layer** proporciona las implementaciones técnicas necesarias para que la **Application Layer** y la **Domain Layer** funcionen correctamente.  
Incluye la **persistencia de datos** y , y cualquier dependencia tecnológica concreta.

---

## Repositories

Los **Repositories** implementan la persistencia de los agregados definidos en el dominio y actúan como puente entre las **Entities/Aggregates** y la base de datos o servicios externos.

| Nombre                     | Descripción                                        | Implementación típica                                                                                                                                                                                                                                                                                                                                                                              |
|----------------------------|----------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **AccountRepository**      | Gestiona la persistencia de cuentas.               | - `AddAsync(Account account)` → Insertar nueva cuenta.<br>- `UpdateAsync(Account account)` → Actualizar cuenta.<br>- `DeleteAsync(string id)` → Eliminar cuenta.<br>- `GetByIdAsync(string id)` → Obtener cuenta por Id.<br>- `GetByStatusAsync(EAccountStatus status)` → Filtrar cuentas por estado.<br>- `GetAllAsync()` → Obtener todas las cuentas.                                            |
| **SubscriptionRepository** | Gestiona la persistencia de suscripciones.         | - `AddAsync(Subscription subscription)` → Crear suscripción.<br>- `UpdateAsync(Subscription subscription)` → Actualizar suscripción.<br>- `DeleteAsync(string id)` → Eliminar suscripción.<br>- `GetByIdAsync(string id)` → Obtener suscripción por Id.<br>- `GetByAccountAsync(string accountId)` → Obtener suscripciones de una cuenta.<br>- `GetActiveAsync()` → Obtener suscripciones activas. |
| **PlanRepository**         | Gestiona la persistencia de planes de suscripción. | - `AddAsync(Plan plan)` → Crear plan.<br>- `UpdateAsync(Plan plan)` → Actualizar plan.<br>- `DeactivateAsync(string id)` → Desactivar plan.<br>- `GetByIdAsync(string id)` → Obtener plan por Id.<br>- `GetAllAsync()` → Obtener todos los planes.<br>- `GetByTypeAsync(EPlanType type)` → Filtrar planes por tipo.                                                                                |
| **BusinessRepository**     | Gestiona la persistencia de negocios asociados.    | - `AddAsync(Business business)` → Crear negocio.<br>- `UpdateAsync(Business business)` → Actualizar negocio.<br>- `GetByIdAsync(string id)` → Obtener negocio por Id.<br>- `GetAllAsync()` → Obtener todos los negocios.                                                                                                                                                                           |


## External Payment Integration

| Nombre                 | Descripción                                                     | Implementación típica                                                                                                                                                                                                                                                                                                                       |
|------------------------|-----------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **MercadoPagoService** | Gestiona la comunicación con la API de Mercado Pago para pagos. | - `CreatePayment(PaymentRequest request)` → Crear un pago en Mercado Pago.<br>- `GetPaymentStatus(string paymentId)` → Consultar el estado de un pago.<br>- `CancelPayment(string paymentId)` → Cancelar un pago.<br>- `WebhookHandler(EventPayload payload)` → Procesar eventos de Mercado Pago (pagos aprobados, rechazados, pendientes). |
