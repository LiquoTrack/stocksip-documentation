#### 4.2.4.4. Infrastructure Layer ####

La **Infrastructure Layer** se responsabiliza de la **persistencia de datos**, la integración con servicios externos y los adaptadores tecnológicos que soportan a la **Application Layer** y a la **Domain Layer** del Bounded Context Profiles. Aquí se implementan los **Repositories** concretos, adaptadores y cualquier componente dependiente de la tecnología elegida.

---

## Repositories


| Nombre                | Descripción                                                                                                                                                                                                             | Implementación (ejemplos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| --------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **ProfileRepository** | Implementación concreta de persistencia para el agregado `Profile` (implementa `IProfileRepository`). Encapsula el acceso a la base de datos y a los mecanismos de almacenamiento asociados (avatares, índices, cache). | - `Task AddAsync(Profile profile, CancellationToken cancellationToken = default)` → Inserta un nuevo perfil en la persistencia.<br> - `Task UpdateAsync(Profile profile, CancellationToken cancellationToken = default)` → Actualiza el perfil existente y sincroniza índices/proyecciones necesarias.<br> - `Task DeleteAsync(Guid id, CancellationToken cancellationToken = default)` → Elimina el perfil y limpia recursos asociados (avatar, cache).<br> - `Task<Profile?> GetByIdAsync(Guid id, CancellationToken cancellationToken = default)` → Recupera un perfil por su Id.<br> - `Task<Profile?> GetByUserIdAsync(UserId userId, CancellationToken cancellationToken = default)` → Obtiene el perfil asociado a un `UserId`.<br> - `Task<IEnumerable<Profile>> GetAllAsync(CancellationToken cancellationToken = default)` → Lista todos los perfiles (útil para procesos batch / administración).<br> - `Task<IEnumerable<Profile>> GetByNameAsync(string name, CancellationToken cancellationToken = default)` → Búsqueda por nombre (puede delegar en un índice o motor de búsqueda).<br> - `Task<IEnumerable<Profile>> GetByFilterAsync(ProfileFilter filter, CancellationToken cancellationToken = default)` → Consultas con criterios (filtros, paginación, ordenamiento). |

---

## External File Storage Intregation

| Nombre                           | Descripción                                                                                                                                             | Implementación                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|----------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **CloudinaryFileStorageAdapter** | Adaptador responsable de subir, obtener, transformar y eliminar imágenes de usuario (avatars) usando Cloudinary como proveedor de almacenamiento y CDN. | - `Task<string> UploadAsync(Stream fileStream, string fileName, UploadOptions options)` → Sube la imagen y devuelve la URL pública o el identificador en Cloudinary.<br> `Task<string> UploadFromUrlAsync(string remoteUrl, UploadOptions options)` → Importa una imagen desde una URL externa.<br> `Task<bool> DeleteAsync(string publicId)` → Elimina un recurso en Cloudinary.<br> `string GetUrl(string publicId, TransformationOptions options)` → Genera URL con transformaciones (crop, resize, quality, format, responsive). |
