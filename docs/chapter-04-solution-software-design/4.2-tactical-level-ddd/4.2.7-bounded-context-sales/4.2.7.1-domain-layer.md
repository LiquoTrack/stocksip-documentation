### 4.2.8.1. Domain Layer

La capa de **Dominio** para el *Bounded Context: Sales Management* encapsula la lógica central asociada a la gestión de órdenes de venta. Aquí se definen los **Aggregates**, **Entities**, **Value Objects**, **Services** y **Repositories** que modelan cómo se crea, procesa y finaliza una orden de venta.  
Una **SalesOrder** representa el compromiso de venta hacia un cliente derivado de una orden de compra. Su ciclo de vida es controlado mediante estados bien definidos (desde *Received* hasta *Arrived* o *Canceled*).

---

## Aggregates

| Nombre         | Descripción                                                                                                   | Atributos                                                                                                                                                  | Métodos                                                     |
|----------------|---------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
| **SalesOrder** | Representa la orden de venta generada a partir de una orden de compra, gestionando sus ítems y ciclo de vida. | `OrderCode: string, PurchaseOrderId: PurchaseOrderId, Items: ICollection<SalesOrderItem>, Status: ESalesOrderStatuses, Buyer: AccountId, CatalogToBuyItem` | `AddItem(), RemoveItem(), CalculateTotal(), ChangeStatus()` |

---

## Entities

| Nombre             | Descripción                                                                                         | Atributos                                                                               | Métodos               |
|--------------------|-----------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------|-----------------------|
| **SalesOrderItem** | Ítem dentro de una orden de venta, con referencia al producto, cantidad y precio acordado de venta. | `ProductId: ProductId, UnitPrice: Money, InventoryId: InventoryId, QuantityToSell: int` | `CalculateSubTotal()` |

---

## Value Objects

| Nombre                  | Descripción                                                                                        | Atributos / Métodos                                                                     |
|-------------------------|----------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------|
| **CatalogId**           | Identificador único de un catálogo desde el cual se genera la orden de venta.                      | `Atributos: { Id: string }`                                                             |
| **PurchaseOrderId**     | Identificador único de la orden de compra que origina la orden de venta.                           | `Atributos: { Id: string }`                                                             |
| **ESalesOrderStatuses** | Enumeración que define los estados posibles de una orden de venta.                                 | `Valores: Received, Processing, Confirmed, Delivering, Arrived, Canceled`               |
| **IDeliverable**        | Interfaz que asegura que la orden de venta siga un ciclo de vida predefinido de entrega y control. | `Métodos: ProcessOrder(), ConfirmOrder(), DeliverOrder(), ArriveOrder(), CancelOrder()` |

---

## Services

| Nombre                        | Descripción                                                                                    | Métodos (Commands / Queries)                                                                                                                                                   |
|-------------------------------|------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ISalesOrderCommandService** | Define operaciones de negocio para crear y gestionar el ciclo de vida de las órdenes de venta. | `CreateSalesOrder(CreateSalesOrderCommand), UpdateSalesOrder(UpdateSalesOrderCommand), CancelSalesOrder(CancelSalesOrderCommand), ChangeStatus(ChangeSalesOrderStatusCommand)` |
| **ISalesOrderQueryService**   | Expone consultas sobre órdenes de venta registradas en el sistema.                             | `GetById(Guid id), GetByBuyer(AccountId buyer), GetAll(), GetByStatus(ESalesOrderStatuses status)`                                                                             |

---

## Repositories

| Nombre                    | Descripción                                                         | Métodos                                                                                                                                                                                                                                                                               |
|---------------------------|---------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ISalesOrderRepository** | Define la persistencia de las órdenes de venta en la base de datos. | `Task<SalesOrder?> GetByIdAsync(Guid id), Task<IEnumerable<SalesOrder>> GetByBuyerAsync(AccountId buyer), Task<IEnumerable<SalesOrder>> GetByStatusAsync(ESalesOrderStatuses status), Task AddAsync(SalesOrder order), Task UpdateAsync(SalesOrder order), Task DeleteAsync(Guid id)` |
