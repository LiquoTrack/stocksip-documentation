#### 4.2.1.4. Infrastructure Layer ####

La **Infrastructure Layer** se encarga de la **persistencia de datos**, de las integraciones externas y de proporcionar los adaptadores y utilidades necesarios para que la **Application Layer** y la **Domain Layer** funcionen. En el contexto del bounded context IAM, esta capa implementa los **repositories**, adaptadores de correo, servicios de tokens, hashing de contraseñas, cachés y cualquier componente dependiente de tecnología concreta.

---

## Repositories

| Nombre                                            | Descripción                                                                                                                                                                                                                                                                                                | Implementación (ejemplos de métodos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UserRepository**  | Responsable de la persistencia y recuperación de los agregados `User`. Traduce entre la representación de persistencia (tablas/entidades ORM) y los objetos del dominio/VOs. También puede encargarse de búsquedas optimizadas (índices) y acceso por campos frecuentemente consultados como email o role. (implementa `IUserRepository`)  | - `Task<User?> GetByIdAsync(int id)` → Obtener usuario por id.<br>- `Task<User?> GetByEmailAsync(Email email)` → Obtener usuario por email (normalizado).<br>- `Task<IEnumerable<User>> GetByRoleAsync(EUserRoles role)` → Obtener usuarios por rol.<br>- `Task<IEnumerable<User>> GetByAccountIdAsync(AccountId accountId)` → Obtener usuarios asociados a una cuenta.<br>- `Task AddAsync(User user)` → Insertar nuevo usuario.<br>- `Task UpdateAsync(User user)` → Actualizar usuario (estado, rol, credenciales hashed).<br>- `Task DeleteAsync(int id)` → Eliminar o marcar como inactivo.<br>- `Task<PagedResult<User>> GetAllAsync(int page, int size)` → Paginación y listados. |
