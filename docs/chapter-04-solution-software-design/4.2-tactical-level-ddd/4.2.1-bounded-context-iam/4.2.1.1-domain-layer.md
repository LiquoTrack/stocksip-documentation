## _4.2. Tactical-Level Domain Driven Design_ ##

### 4.2.1. Bounded Context: IAM (Identity and Access Management) ###

#### 4.2.1.1. Domain Layer ####

La capa IAM (Identity & Access Management) constituye el núcleo del bounded context dedicado a la identidad y el control de accesos, centralizando toda la lógica de negocio relacionada con usuarios, credenciales y roles relacionada con (`User`). 

En esta capa se definen las reglas y comportamientos propios del dominio IAM: validación y normalización de correos, enforcement de políticas de contraseña, gestión de la asociación entre usuario y cuenta, y control de la asignación y cambios de rol.

## Aggregates

| Nombre     | Descripción                                                                                                                                                                  | Atributos                                                                                                                                                                                                       | Métodos                                                                                                                            |
| ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| **`User`** | Aggregate Root que representa a un usuario del sistema; encapsula identidad, credenciales, relación con cuenta y rol de usuario, y operaciones invariantes sobre el usuario. | `Id: int`  <br>`Email: Email`  <br>`Username: string`  <br>`Password: string`  <br>`CreatedAt: DateTime`  <br>`UpdatedAt: DateTime`  <br>`AccountId: AccountId`  <br>`UserRole: Role`  <br>`UserRoleId: string` | `ChangePassword(string newPassword): User`  <br>`UpdateUsername(string newUsername): User`  <br>`ChangeRole(string newRole): void` |

## Entities

| Nombre     | Descripción                                                                                               | Atributos                            | 
| ---------- | --------------------------------------------------------------------------------------------------------- | ------------------------------------ | 
| **`Role`** | Entidad que representa el rol asignado a un usuario. Puede relacionarse con permisos y reglas de negocio. | `Id: string`  <br>`Name: EUserRoles` | 

## Value Objects

| Nombre                          | Descripción                                                                                      | Atributos / Valores                                                |
| ------------------------------- | ------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------ |
| **`EUserRoles`**                | Enumeración que modela los roles posibles que un usuario puede tener en el sistema.              | `SuperAdmin`, `Admin`, `AccountOwner`, `Normal`                    |

## Services

| Nombre                    | Descripción                                                                        | Métodos                                                                                                                                                                                                                                          |
| ------------------------- | ---------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **`IUserCommandService`** | Interfaz que define las operaciones de negocio (comandos) para gestionar usuarios. | `Task<User> Handle(CreateUserCommand command)`  <br>`Task<User> Handle(UpdateUserCommand command)`  <br>`Task Handle(ChangePasswordCommand command)`  <br>`Task Handle(ChangeRoleCommand command)`  <br>`Task Handle(DeleteUserCommand command)` |
| **`IUserQueryService`** | Interfaz que expone consultas sobre usuarios. | `Task<UserDto?> Handle(GetUserByIdQuery query)`  <br>`Task<UserDto?> Handle(GetUserByEmailQuery query)`  <br>`Task<IEnumerable<UserDto>> Handle(GetUsersByRoleQuery query)`  <br>`Task<PagedResult<UserDto>> Handle(GetAllUsersQuery query)` |

## Repositories

| Nombre                | Descripción                                             | 
| --------------------- | ------------------------------------------------------- | 
| **`IUserRepository`** | Define la persistencia para la entidad `User`. | 
